
# How to customize user authentication with Devise and Rails (Beginner friendly tutorial).

User authentication is an important feature for web applications, and implementing it can be a challenging task.Â 

I recently started learning Ruby on rails and I spent more time that I wish to admit trying to customize the user authentication flow in some of my applications. Devise is a powerful authentication gem for Ruby on Rails, which comes with many prepackaged and useful tools to make life easy for  beginners like myself.Â 

_Disclaimer: I am still new to Rails therefore I would definitely not consider myself an expert on the topic. I just needed to implement user authentication for an application I was building and although there are many excellents tutorials out there, none of them had quite the information I was looking for. Through a rabbit hole of stack overflow articles and Youtube videos, I was able to achieve what I wanted, which is have a user login using their name, email address and password, a profile page they could edit and log out. I figured I would write down the step I followed in on place for other beginners like myself who may encounter the same issue. Feedback on the content I share is always welcome and appreciated! On that note, let's beginâ€¦_

**Prerequisite: Rails 7, devise 4.9.2.**

Okay for the purpose of brevity I will assume you already have a rails app up and running with Devise installed. If not, no sweat! here is an excellent tutorial that will show step by step how to install Devise in your rails application. After following it, you should be able to access the sign in page by appending `/users/sign_in` to the landing page url, like so `http://localhost:3000/users/sign_in.`Â 


![Log in page](https://file%2B.vscode-resource.vscode-cdn.net/Users/sakatia/Desktop/blog/app/assets/images/Login%20.jpg?version%3D1682171453886)


Right now, a user can register with an email and a password and then sign in, but what if I want them to also provide their name (or a username, address or phone number  instead) upon registration? This is the feature we will try to implement through following steps:

## Step 0â€Š-â€ŠModify the user model to add a name and address attribute:

In your terminal, run:

```
rails g migration addNameAndAddressToUser
```

A new migration file will be created under db/migrate. Inside the migration file, paste the following:

```
def up
    add_columnÂ :users,Â :name,Â :string
    add_columnÂ :users,Â :address,Â :string
end

def down
    remove_columnÂ :users,Â :name
    remove_columnÂ :users,Â :address
end
```
save and then run the commandÂ 

```
rails db:migrate
```

**what it does:** The user model generated by devise comes with predefined attributes like email or encrypted password. For our application purposes we also want to store the user's name and address. To accomplish this, we have to create a migration that will add those additional attributes to the user model.

In your schema (which you can find under db/migrate/schema.rb) you should now see the newly created attributes for the user table. It should look something like this:
```
...
t.string "name"
t.string "address"
...
```

## STEP 1 - Modify Devise controllers to include the new attributes.Â 

In your terminal, type:Â 
```
rails g devise:controllers users 
```
and hit enter.

**What it does:** Helps us access the logic behind Devise authentication. Allows us to customize the controller logic to meet our app requirement.Â 
You should now see a new folder under `app/controllers` called users.

## STEP 2â€Š-â€ŠTell Devise we also need a name and an address for a user to register:

In `app/controllers/users/registrations_controller.rb`, remove the hashtags (#) to uncomment all the methods _(make sure to also uncomment before_actionÂ :configure_sign_up_params, only: [:create]
before_actionÂ :configure_account_update_params, only: [:update]
as well as the protected keyword towards the bottom)_

Find the protected method `configure_sign_up_params` and update it it to the following:
```
def configure_sign_up_params
devise_parameter_sanitizer.permit(:sign_up, keys: [:name,Â :address])
endÂ 
```

(We should also do the same for the configure_account_update_params method underneath)

**What it does:** This is how we tell devise that in order for a user to create an account they will also need to provide their name and their address in addition to their email and password. Additionally, Updating the second method configure_account_update_params make it so that the newly added attributes can be updated later by the user when they wish to modify their profile.

## STEP 3â€Š-â€ŠUpdate our routes with a path for our recently modified controller.

In `config/routes.rb`, add the following line after `devise_for:users`. It should look something like this:Â 

```
devise_forÂ :users, controllers: {
registrations: "users/registrations",
}Â 
```

What it does: This allows us to tell Devise to use our custom controller (that we created in the previous steps) instead of its internal one.

## STEP 4â€Š-â€ŠAdjust the template to include a text field for the additional attribute.

In your terminal, enter the following command:
```
Â rails g devise:views 
```

and hit enter.

You should have a new folder called `devise` under `app/views`. In `views/devise/registrations/new.html.erb` make sure to add two additional text fields for the name and address attributes. Like so:

#### for the name:
```
<div class="field">
<%= f.labelÂ :name %><br />
<%= f.text_fieldÂ :name, autofocus: true, autocomplete: "name" %>
</div>
```

#### for the address:Â 
````
<div class="field">
<%= f.labelÂ :address %><br />
<%= f.text_fieldÂ :address, autofocus: true, autocomplete: "address" %>
</div>
````

(Once gain, we should also do the same in `views/devise/registrations/edit.html.erb` to allow users to edit their name and address).

**What it does:** As previously mentioned, by default Devise only requires an email and a password to register so there are only two input fields in the `new.html.erb` view. With this step, with add an extra input field for the user to also enter their name and their address.
Â 
And voila! A user should now be able to create a new account with their name, address, email and password.Â 

If you haven't already, start the server with the command `rails server`. From your home page, navigate to the sign up page by clicking on Sign in and then sign up (or simply append '/users/sign_up' to http://localhost:3000) and you will see that in addition to email and password, name and address are also required to register.
Â 

![Sign up page](https://file%2B.vscode-resource.vscode-cdn.net/Users/sakatia/Desktop/blog/app/assets/images/signup.%20.jpg?version%3D1682171497463)


Similarly, if you want to edit the user info, navigate to the edit page at `http://localhost:3000/users/edit` and notice that the user can also edit their name and their address.


![Edit user page](https://file%2B.vscode-resource.vscode-cdn.net/Users/sakatia/Desktop/blog/app/assets/images/edit.jpg?version%3D1682171513316)


You can recreate these steps with different attributes (phone number, username, etc.) to better meet your app requirement. I hope you enjoyed the tutorial and found it helpful ðŸ™‚
